---
import Layout from '../../../layouts/Layout.astro'
import { getCollection } from 'astro:content'

import PostList from '../../../components/PostList.astro'
import TagList from '../../../components/TagList.astro'
import Container from '../../../components/Container.astro'
import RecipeHeader from '../../../components/RecipeHeader.astro'

import { DEFAULT_LOCALE, type Locale } from '../../../i18n/locales'

// âœ… REQUIRED because this route has [locale]
export function getStaticPaths() {
  return [{ params: { locale: 'pl' } }, { params: { locale: 'de' } }]
}

const locale = (Astro.params.locale ?? DEFAULT_LOCALE) as Locale

// âœ… filter by locale
const allPosts = await getCollection('recipes', (p) => p.slug.startsWith(`${locale}/`))
const tags = Array.from(new Set(allPosts.flatMap((p) => p.data.tags)))
---

<Layout title='Recipes' active='recipes'>
  <Container>
    <RecipeHeader />

    <div class='max-lg:grid-cols-1 mb-16 grid grid-cols-[auto,1fr] gap-x-14 gap-y-3'>
      <TagList tags={tags} title={'Tags'} />
    </div>

    <div class='mb-32'>
      <PostList posts={allPosts} />
    </div>
  </Container>
</Layout>
