---
import Layout from "../../../layouts/Layout.astro";
import { getCollection } from "astro:content";

import Container from "../../../components/Container.astro";
import RecipeHeader from "../../../components/RecipeHeader.astro";
import Tag from "../../../components/Tag.astro";

import { getTranslation } from "../../../i18n";
import { DEFAULT_LOCALE, type Locale } from "../../../i18n/locales";

// required because [locale] is dynamic
export function getStaticPaths() {
  return [{ params: { locale: "pl" } }, { params: { locale: "de" } }];
}

const locale = (Astro.params.locale ?? DEFAULT_LOCALE) as Locale;
const t = getTranslation(locale);

// locale-only posts
const allPosts = await getCollection("recipes", (p) => p.slug.startsWith(`${locale}/`));

const tagKeys = Array.from(
  new Set(allPosts.flatMap((post) => post.data.tags.map((x) => String(x).toLowerCase())))
).sort();

const tagsTitle = t.common?.tags ?? "Tags";
const pageTitle = t.nav?.recipes ?? "Recipes";
---

<Layout title={pageTitle} active="recipes">
  <Container>
    <RecipeHeader />

    <div class="grid grid-cols-[auto,1fr] gap-x-14 gap-y-3 mb-16 max-lg:grid-cols-1">
      <h2 class="font-bold text-5xl text-yellow-800">{tagsTitle}</h2>

      <div class="flex gap-4 flex-wrap justify-center items-center">
        {tagKeys.map((key) => <Tag tag={key} />)}
      </div>
    </div>
  </Container>
</Layout>
